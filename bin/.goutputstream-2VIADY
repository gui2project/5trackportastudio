#!/bin/bash
CONFIG="../ini/mongodb.conf"                # relative path to config file
declare -A CONFIG_ARR=()                    # configuration array
IFS="="                                     # configuration separator

#   PARAMETER DEFAULTS
INSTALL=0                                   # install the windows service
START=0                                     # start the windows service
STOP=0                                      # stop the windows service
RESTART=0                                   # restart the windows service

#   PARSE PARAMETERS
for i in "$@"
do
    case $i in
        --install|-i)
        INSTALL=1
        shift
        ;;
        --start|-s)
        START=1
        shift
        ;;
        --stop|-t)
        STOP=1
        shift
        ;;
        --restart|-r)
        END=1
        START=1
        shift
        ;;
        *)
        echo "unknown option given"         # unknown option do nothing
        ;;
    esac
done

#   FIND ABSOLUTE PATH TO CONFIGURATION FILE
REL_PATH="`dirname \"$0\"`"
ABS_PATH="`( cd \"$REL_PATH\" && pwd )`"
CONFIG=${ABS_PATH}"/"${CONFIG}

#   EXTRACT CONFIG FILE KEY-PAIRS
while read -r key val; do
    CLEAN_KEY=$(echo $key | tr -d ' ')
    CLEAN_VAL=$(echo $val | sed -e 's/^[ \t]*//')
    CONFIG_ARR[$CLEAN_KEY]=${CLEAN_VAL}
done < ${CONFIG}


#   EXECUTE OPTIONS
if (( "${INSTALL}" == 1 )); then
    mongod -f ${CONFIG} --install
fi

if (( ( "${RESTART}" == 1 ) ||
      ( "${START}" == 1 && "${STOP}" == 1 ) )); then
    net stop ${CONFIG_ARR[serviceName]}
    net start ${CONFIG_ARR[serviceName]}
elif (( "${START}" == 1 )); then
    net start ${CONFIG_ARR[serviceName]}
elif (( "${STOP}"  == 1 )); then
    net stop ${CONFIG_ARR[serviceName]}
fi

#   TERMINATE
read -n1 -r -p "Press space to continue..." tmp

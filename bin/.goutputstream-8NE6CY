#!/bin/bash
CONFIG="../ini/mongodb.conf"

#   FIND CONFIG FILE
#   Code from http://stackoverflow.com/questions/630372/determine-the-path-of-the-executing-bash-script
MY_PATH="`dirname \"$0\"`"              # relative
MY_PATH="`( cd \"$MY_PATH\" && pwd )`"  # absolutized and normalized
if [ -z "$MY_PATH" ] ; then
  exit 1  # fail
fi
ABS_CONFIG=${MY_PATH}"/"${CONFIG}       # absolute path to config file

#   EXTRACT CONFIG FILE KEY-PAIRS
declare -A CONFIG_ARR=()
IFS="="
while read -r key val; do
    CLEAN_KEY=$(echo $key | tr -d ' ')
    CLEAN_VAL=$(echo $val | sed -e 's/^[ \t]*//')
    CONFIG_ARR[$CLEAN_KEY]=${CLEAN_VAL}
    echo "CONFIG_ARR[${$CLEAN_KEY}]=${CONFIG_ARR[$CLEAN_KEY]}"
done < ${ABS_CONFIG}

echo ${CONFIG_ARR[serviceName]}

#   PARSE PARAMETERS
INSTALL=0
START=0
END=0
RESTART=0

for i in "$@"
do
case $i in
    --install|-i)
    INSTALL=1
    shift # past argument with no value
    ;;
    --start|-s)
    START=1
    shift # past argument with no value
    ;;
    --stop|-t)
    END=1
    shift # past argument with no value
    ;;
    --restart|-r)
    END=1
    START=1
    shift # past argument with no value
    ;;
    *)
            # unknown option
    ;;
esac
done

#   EXECUTE OPTIONS
if [ "${INSTALL}" = 1 ]; then
    mongod -f ${CONFIG} --install
fi

if (( ( "${RESTART}" == 1 ) || ( "${START}" == 1 && "${END}" == 1 ) )); then
    net stop ${NAME}
    net start ${NAME}
elif [ "${START}" = 1 ]; then
    net start ${NAME}
elif [ "${END}" = 1 ]; then
    net stop ${NAME}
fi

#   TERMINATE
read -n1 -r -p "Press space to continue..." tmp

#!/bin/bash
CONFIG="../ini/mongodb.conf"
declare -A CONFIG_ARR=()

IFS="="

INSTALL=0
START=0
END=0
RESTART=0



#   FIND CONFIG FILE
REL_PATH="`dirname \"$0\"`"
ABS_PATH="`( cd \"$REL_PATH\" && pwd )`"
CONFIG=${ABS_PATH}"/"${CONFIG}

#   EXTRACT CONFIG FILE KEY-PAIRS
while read -r key val; do
    CLEAN_KEY=$(echo $key | tr -d ' ')
    CLEAN_VAL=$(echo $val | sed -e 's/^[ \t]*//')
    CONFIG_ARR[$CLEAN_KEY]=${CLEAN_VAL}
    #OUT=${CONFIG_ARR[$CLEAN_KEY]}
    #echo "CONFIG_ARR[${CLEAN_KEY}]=${CONFIG_ARR[$CLEAN_KEY]}"
done < ${CONFIG}

#   PARSE PARAMETERS
for i in "$@"
do
    case $i in
        --install|-i)
        INSTALL=1
        shift # past argument with no value
        ;;
        --start|-s)
        START=1
        shift # past argument with no value
        ;;
        --stop|-t)
        END=1
        shift # past argument with no value
        ;;
        --restart|-r)
        END=1
        START=1
        shift # past argument with no value
        ;;
        *)
                # unknown option
        ;;
    esac
done

#   EXECUTE OPTIONS
if [ "${INSTALL}" = 1 ]; then
    mongod -f ${CONFIG} --install
fi

if (( ( "${RESTART}" == 1 ) || ( "${START}" == 1 && "${END}" == 1 ) )); then
    net stop ${CONFIG_ARR[serviceName]}
    net start ${CONFIG_ARR[serviceName]}
elif [ "${START}" = 1 ]; then
    net start ${CONFIG_ARR[serviceName]}
elif [ "${END}" = 1 ]; then
    net stop ${CONFIG_ARR[serviceName]}
fi

#   TERMINATE
read -n1 -r -p "Press space to continue..." tmp
